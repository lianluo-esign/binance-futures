# GUI优化需求文档

## 介绍

本规范旨在优化当前的订单薄GUI显示系统，主要解决以下问题：
1. 移除不必要的价格层级高亮显示，保持订单薄深度数据展示
2. 实现智能跟随best bid price，使其保持在窗口正中间
3. 重新设计订单薄显示布局，将bid和ask合并显示，并添加横向条形图可视化

## 需求

### 需求 1: 移除价格层级高亮显示

**用户故事:** 作为交易员，我希望订单薄显示更加简洁，不需要价格层级的高亮显示，这样可以减少视觉干扰，专注于订单深度数据。

#### 验收标准

1. WHEN 订单薄渲染时 THEN 系统 SHALL 移除所有价格层级的背景高亮显示
2. WHEN 交易发生时 THEN 系统 SHALL 保留交易价格的短暂高亮（3秒），但移除静态价格层级高亮
3. WHEN 显示订单薄时 THEN 系统 SHALL 保持所有订单深度数据的完整显示

### 需求 2: 智能跟随best bid price居中显示

**用户故事:** 作为交易员，我希望窗口能够智能跟随当前的best bid price，使其始终保持在窗口正中间，这样我可以更好地观察买卖盘的分布情况。

#### 验收标准

1. WHEN best bid price更新时 THEN 系统 SHALL 自动调整窗口滚动位置使best bid price居中显示
2. WHEN best bid price变化超过设定阈值时 THEN 系统 SHALL 触发窗口重新居中
3. WHEN 用户手动滚动时 THEN 系统 SHALL 暂时禁用自动居中功能
4. WHEN 用户按下特定快捷键时 THEN 系统 SHALL 重新启用自动居中功能
5. IF best bid price数据不可用 THEN 系统 SHALL 使用当前交易价格作为替代居中参考

### 需求 3: 合并bid & ask列显示

**用户故事:** 作为交易员，我希望订单薄能够在单列中同时显示bid和ask数据，列标题为"Bid & Ask"，这样可以更紧凑地查看订单深度信息。

#### 验收标准

1. WHEN 渲染订单薄时 THEN 系统 SHALL 创建名为"Bid & Ask"的单列
2. WHEN 价格等于或低于best bid price时 THEN 系统 SHALL 在该列显示bids挂单数据
3. WHEN 价格等于或高于best ask price时 THEN 系统 SHALL 在该列显示asks挂单数据
4. WHEN 价格在best bid和best ask之间时 THEN 系统 SHALL 显示空白或分隔符

### 需求 4: 横向条形图可视化

**用户故事:** 作为交易员，我希望每个价格层级的bid & ask单元格内部能够用横向条形图显示数量大小，这样可以直观地比较不同价格层级的订单深度。

#### 验收标准

1. WHEN 显示bid数据时 THEN 系统 SHALL 在单元格内绘制绿色横向条形图，长度与bid数量成正比
2. WHEN 显示ask数据时 THEN 系统 SHALL 在单元格内绘制红色横向条形图，长度与ask数量成正比
3. WHEN 条形图长度计算时 THEN 系统 SHALL 基于当前可见价格层级的最大数量进行归一化
4. WHEN 条形图显示时 THEN 系统 SHALL 在条形图上叠加显示具体的数量文本
5. WHEN 数量为0时 THEN 系统 SHALL 不显示条形图，仅显示空白单元格

### 需求 5: 代码结构优化

**用户故事:** 作为开发者，我希望代码文件保持合理的大小，单个文件不超过1000行，这样便于维护和理解。

#### 验收标准

1. WHEN 重构代码时 THEN 系统 SHALL 确保单个代码文件不超过1000行
2. WHEN 文件过大时 THEN 系统 SHALL 将功能拆分到多个模块文件中
3. WHEN 拆分模块时 THEN 系统 SHALL 保持清晰的模块职责分离
4. WHEN 重构完成时 THEN 系统 SHALL 保持所有现有功能的完整性

### 需求 6: 性能优化

**用户故事:** 作为用户，我希望GUI渲染性能保持流畅，即使在高频数据更新时也不会出现卡顿。

#### 验收标准

1. WHEN 订单薄数据更新时 THEN 系统 SHALL 保持60FPS的渲染性能
2. WHEN 计算条形图时 THEN 系统 SHALL 使用高效的算法避免重复计算
3. WHEN 窗口居中时 THEN 系统 SHALL 使用平滑的滚动动画而非跳跃式移动
4. WHEN 处理大量价格层级时 THEN 系统 SHALL 只渲染可见区域的数据