# Binance 期货到现货切换任务清单

## 项目概述
将当前的 Binance BTCUSDT 期货品种切换为 BTCFDUSD 现货品种，采用现货的 WebSocket 连接，同时保持 GUI 显示一致。

## 主要变更点
1. **WebSocket 连接地址变更**: 从 `wss://fstream.binance.com` 切换到 `wss://stream.binance.com:9443`
2. **交易对变更**: 从 `btcusdt` 切换到 `btcfdusd`
3. **数据流格式**: 保持相同的流名称格式，但使用现货 API

## 详细任务分解

### 阶段 1: WebSocket 连接配置修改

#### 任务 1.1: 修改 WebSocket 基础 URL
- **文件**: `src/websocket/connection.rs`
- **修改内容**: 
  - 将 `build_url()` 方法中的基础 URL 从 `wss://fstream.binance.com` 改为 `wss://stream.binance.com:9443`
  - 更新相关的注释和文档
- **测试**: 验证 URL 构建正确性
- **预计时间**: 30分钟

#### 任务 1.2: 更新交易对配置
- **文件**: `src/websocket/connection.rs`
- **修改内容**:
  - 修改 `WebSocketConfig::new()` 方法中的默认交易对
  - 将 `btcusdt` 改为 `btcfdusd`
  - 更新流名称生成逻辑
- **测试**: 验证流名称格式正确性
- **预计时间**: 45分钟

#### 任务 1.3: 验证现货 API 流格式
- **文件**: `src/websocket/connection.rs`
- **修改内容**:
  - 确认现货 API 的流名称格式与期货一致
  - 验证 `btcfdusd@depth20@100ms` 和 `btcfdusd@trade` 流
  - 检查是否需要 `@bookTicker` 流
- **测试**: 连接测试，验证数据流正常
- **预计时间**: 1小时

### 阶段 2: 应用程序配置更新

#### 任务 2.1: 更新主应用程序配置
- **文件**: `src/app/reactive_app.rs`
- **修改内容**:
  - 更新默认交易对配置
  - 修改应用程序初始化时的交易对设置
  - 更新相关的日志信息
- **测试**: 验证应用程序启动时使用正确的交易对
- **预计时间**: 30分钟

#### 任务 2.2: 更新主程序入口
- **文件**: `src/main.rs`
- **修改内容**:
  - 更新默认交易对参数
  - 修改命令行参数处理逻辑
  - 更新帮助信息
- **测试**: 验证命令行参数处理
- **预计时间**: 20分钟

### 阶段 3: 数据处理逻辑验证

#### 任务 3.1: 验证现货数据格式兼容性
- **文件**: `src/orderbook/manager.rs`
- **修改内容**:
  - 检查现货 API 返回的数据格式是否与期货一致
  - 验证深度数据、交易数据的字段名称
  - 确认数据解析逻辑无需修改
- **测试**: 使用现货数据测试订单簿更新
- **预计时间**: 1.5小时

#### 任务 3.2: 更新事件处理逻辑
- **文件**: `src/app/reactive_app.rs`
- **修改内容**:
  - 检查 `convert_message_to_event()` 方法中的流名称匹配逻辑
  - 确认现货数据的事件类型映射正确
  - 验证事件分发逻辑
- **测试**: 验证事件处理流程
- **预计时间**: 45分钟

#### 任务 3.3: 验证市场数据处理器
- **文件**: `src/handlers/market_data.rs`
- **修改内容**:
  - 检查现货数据的字段解析逻辑
  - 验证价格、数量、时间戳等关键字段
  - 确认信号检测逻辑适用
- **测试**: 验证市场数据处理
- **预计时间**: 1小时

### 阶段 4: GUI 显示验证

#### 任务 4.1: 验证订单簿显示
- **文件**: `src/gui/orderbook_widget.rs`
- **修改内容**:
  - 确认现货数据的价格显示格式
  - 验证成交量显示逻辑
  - 检查颜色编码和格式化
- **测试**: 验证 GUI 显示正确性
- **预计时间**: 30分钟

#### 任务 4.2: 验证时间足迹图表
- **文件**: `src/gui/time_footprint_chart.rs`
- **修改内容**:
  - 检查现货交易数据的时间足迹处理
  - 验证价格层级聚合逻辑
  - 确认图表渲染正确性
- **测试**: 验证时间足迹图表显示
- **预计时间**: 45分钟

#### 任务 4.3: 验证交易足迹组件
- **文件**: `src/gui/trade_footprint_widget.rs`
- **修改内容**:
  - 检查现货交易数据的足迹处理
  - 验证买卖方向判断逻辑
  - 确认动画效果正常
- **测试**: 验证交易足迹显示
- **预计时间**: 30分钟

### 阶段 5: 配置和文档更新

#### 任务 5.1: 更新配置文件
- **文件**: `docs/CONFIGURATION.md`
- **修改内容**:
  - 更新 WebSocket 连接配置说明
  - 修改交易对配置示例
  - 更新现货 API 相关说明
- **测试**: 验证配置文档准确性
- **预计时间**: 30分钟

#### 任务 5.2: 更新架构文档
- **文件**: `ARCHITECTURE.md`, `ARCHITECTURE.CN.md`
- **修改内容**:
  - 更新 WebSocket 集成部分
  - 修改数据流说明
  - 更新现货 API 相关信息
- **测试**: 验证文档一致性
- **预计时间**: 45分钟

#### 任务 5.3: 更新 README 文档
- **文件**: `README.md`
- **修改内容**:
  - 更新项目描述，从期货改为现货
  - 修改交易对示例
  - 更新技术特性说明
- **测试**: 验证 README 准确性
- **预计时间**: 30分钟

### 阶段 6: 测试和验证

#### 任务 6.1: 单元测试更新
- **文件**: `tests/` 目录下的测试文件
- **修改内容**:
  - 更新测试用例中的交易对
  - 修改模拟数据格式
  - 验证测试覆盖率
- **测试**: 运行所有单元测试
- **预计时间**: 1小时

#### 任务 6.2: 集成测试
- **文件**: `tests/integration_test.rs`
- **修改内容**:
  - 更新集成测试配置
  - 验证端到端数据流
  - 测试连接稳定性
- **测试**: 运行集成测试
- **预计时间**: 1.5小时

#### 任务 6.3: 性能测试
- **文件**: `tests/performance_test.rs`
- **修改内容**:
  - 验证现货数据的处理性能
  - 测试内存使用情况
  - 确认延迟指标
- **测试**: 运行性能测试
- **预计时间**: 1小时

### 阶段 7: 部署和验证

#### 任务 7.1: 构建验证
- **命令**: `cargo build --release`
- **验证内容**:
  - 确认编译无错误
  - 验证二进制文件大小合理
  - 检查依赖项正确性
- **预计时间**: 15分钟

#### 任务 7.2: 功能测试
- **测试内容**:
  - 启动应用程序
  - 验证 WebSocket 连接成功
  - 确认数据显示正常
  - 测试 GUI 交互功能
- **预计时间**: 1小时

#### 任务 7.3: 稳定性测试
- **测试内容**:
  - 长时间运行测试（2-4小时）
  - 验证连接稳定性
  - 测试内存泄漏
  - 确认错误处理机制
- **预计时间**: 4小时

## 风险评估和注意事项

### 高风险项
1. **现货 API 数据格式差异**: 需要仔细验证现货和期货 API 的数据格式是否完全一致
2. **连接稳定性**: 现货 API 可能有不同的连接限制和稳定性要求
3. **数据延迟**: 现货数据可能有不同的延迟特性

### 中风险项
1. **GUI 显示兼容性**: 现货数据的显示格式可能需要微调
2. **事件处理逻辑**: 现货数据的事件类型可能需要调整
3. **性能影响**: 现货 API 的性能特性可能影响整体性能

### 低风险项
1. **配置更新**: 主要是文本修改，风险较低
2. **文档更新**: 主要是说明性内容，风险较低

## 回滚计划

如果现货切换过程中遇到问题，可以快速回滚到期货版本：

1. **代码回滚**: 使用 Git 回滚到期货版本
2. **配置恢复**: 恢复期货相关的配置
3. **测试验证**: 确认期货版本功能正常

## 总时间估算

- **开发时间**: 约 12-15 小时
- **测试时间**: 约 8-10 小时
- **文档更新**: 约 2-3 小时
- **总计**: 约 22-28 小时（3-4 个工作日）

## 成功标准

1. **功能完整性**: 所有现有功能在现货版本中正常工作
2. **性能指标**: 保持与期货版本相同的性能水平
3. **稳定性**: 连接稳定，无内存泄漏
4. **用户体验**: GUI 显示和交互体验保持一致
5. **文档准确性**: 所有文档反映现货版本的实际情况 