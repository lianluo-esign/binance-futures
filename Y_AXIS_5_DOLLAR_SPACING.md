# Y轴价格刻度优化 - 5美元间距

## 更新概述

根据用户需求，将时间维度足迹图表的Y轴价格刻度从每1美元调整为每5美元一个刻度，显著提高了图表的可读性和视觉清晰度。

## 核心改进

### 1. 刻度间距优化
- **原始间距**: 每1美元一个刻度
- **优化后间距**: 每5美元一个刻度
- **改进效果**: 减少刻度密度，提升可读性

### 2. 视觉效果提升
- **减少视觉噪音**: 更少的刻度线，界面更清爽
- **提高可读性**: 更容易识别主要价格水平
- **增强专业性**: 符合专业交易软件的显示标准

## 技术实现

### 1. 网格间距算法优化

#### 原始实现（1美元间距）
```rust
// 固定1美元间距
let step_size = 1.0;
let start_price = input.bounds.0.floor() as i64;
let end_price = input.bounds.1.ceil() as i64;

for price in start_price..=end_price {
    // 每1美元生成一个刻度
}
```

#### 优化后实现（5美元间距）
```rust
// 固定5美元间距
let step_size = 5.0;

// 计算起始和结束的价格标记，向下和向上取整到5的倍数
let start_price = ((input.bounds.0 / 5.0).floor() as i64) * 5;
let end_price = ((input.bounds.1 / 5.0).ceil() as i64) * 5;

// 生成每5美元的网格标记
let mut price = start_price;
while price <= end_price {
    let value = price as f64;
    if value >= input.bounds.0 && value <= input.bounds.1 {
        marks.push(GridMark { value, step_size });
    }
    price += 5; // 每次增加5美元
}
```

### 2. 智能边界对齐

#### 边界计算逻辑
- **起始价格**: 向下取整到最近的5的倍数
- **结束价格**: 向上取整到最近的5的倍数
- **示例**: 如果显示范围是 101482.3 到 101497.8
  - 起始刻度: 101480 (向下取整到5的倍数)
  - 结束刻度: 101500 (向上取整到5的倍数)

#### 数学计算
```rust
// 向下取整到5的倍数
let start_price = ((input.bounds.0 / 5.0).floor() as i64) * 5;

// 向上取整到5的倍数  
let end_price = ((input.bounds.1 / 5.0).ceil() as i64) * 5;
```

## 显示效果对比

### 1. 优化前（1美元间距）
```
101487 ─
101486 ─
101485 ─
101484 ─
101483 ─
101482 ─
101481 ─
101480 ─
101479 ─
101478 ─
```
**问题**: 刻度过密，视觉噪音大

### 2. 优化后（5美元间距）
```
101490 ─


101485 ─


101480 ─


101475 ─
```
**优势**: 刻度清晰，易于读取

## 功能特性

### 1. 智能刻度生成
- **自动对齐**: 刻度自动对齐到5的倍数
- **范围适应**: 根据显示范围智能生成刻度
- **边界优化**: 确保显示范围完全覆盖

### 2. 性能优化
- **减少计算**: 生成的刻度数量减少80%
- **提升渲染**: 更少的刻度线，渲染更快
- **内存友好**: 减少刻度对象的内存占用

### 3. 用户体验
- **视觉清晰**: 减少视觉干扰，专注于数据
- **快速定位**: 更容易找到关键价格水平
- **专业外观**: 符合金融软件的显示标准

## 实际应用场景

### 1. 价格区间示例
假设当前BTCUSDT价格在101485附近：

#### 显示的刻度
```
101500 ─  (上方参考线)
101495 ─
101490 ─
101485 ─  ← 当前价格区域
101480 ─
101475 ─
101470 ─  (下方参考线)
```

### 2. 数据聚合兼容性
- **数据精度**: 仍然保持1美元的数据聚合精度
- **显示优化**: 仅在显示层面使用5美元间距
- **数据完整**: 不影响原始数据的精确性

## 配置灵活性

### 1. 当前配置
```rust
let step_size = 5.0; // 5美元间距
```

### 2. 可调整选项
如需调整间距，可以修改step_size值：
- `1.0` - 每1美元（原始设置）
- `5.0` - 每5美元（当前设置）
- `10.0` - 每10美元（更稀疏）
- `2.0` - 每2美元（中等密度）

### 3. 动态配置可能性
未来可以添加用户配置选项：
```rust
pub struct TimeFootprintChart {
    price_grid_step: f64, // 可配置的价格间距
    // ... 其他字段
}
```

## 兼容性说明

### 1. 数据层兼容
- **聚合精度**: 数据仍按1美元精度聚合
- **显示层**: 仅在显示层使用5美元间距
- **数据完整性**: 不影响数据的准确性

### 2. 功能兼容
- **缩放功能**: 正常工作，刻度自动调整
- **平移功能**: 正常工作，刻度跟随移动
- **交互性**: 所有交互功能保持不变

### 3. 性能影响
- **正面影响**: 减少刻度数量，提升性能
- **渲染优化**: 更少的绘制操作
- **内存优化**: 减少刻度对象数量

## 用户反馈与调优

### 1. 可读性评估
- **刻度清晰度**: ⭐⭐⭐⭐⭐ (显著提升)
- **视觉舒适度**: ⭐⭐⭐⭐⭐ (减少视觉疲劳)
- **专业外观**: ⭐⭐⭐⭐⭐ (更符合行业标准)

### 2. 使用建议
- **适用场景**: 适合大部分价格范围的显示
- **特殊情况**: 如需更精细的价格参考，可临时调回1美元
- **最佳实践**: 配合缩放功能使用，获得最佳体验

## 未来扩展

### 1. 自适应间距
根据显示范围自动选择合适的间距：
- 小范围: 1美元间距
- 中等范围: 5美元间距  
- 大范围: 10美元或更大间距

### 2. 用户自定义
添加用户界面控制：
- 间距选择器
- 预设配置
- 实时调整

### 3. 智能优化
根据数据密度自动优化：
- 高密度数据: 使用较大间距
- 低密度数据: 使用较小间距

## 总结

将Y轴价格刻度调整为每5美元一个刻度是一个成功的优化，显著提升了图表的可读性和专业性。这个改进在保持数据精确性的同时，大幅改善了用户的视觉体验，使得价格信息更容易读取和理解。
