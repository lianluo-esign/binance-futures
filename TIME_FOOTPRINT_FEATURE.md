# 时间维度足迹图表功能

## 功能概述

本次更新为Binance期货交易界面添加了全新的时间维度足迹图表功能，实现了左右分割布局，提供更全面的市场数据分析视角。

## 新增功能

### 1. 左右分割布局
- **左侧区域（70%）**: 原有的统一订单簿表格
- **右侧区域（30%）**: 全新的时间维度足迹图表
- **响应式设计**: 自动适配不同窗口大小

### 2. 时间维度足迹图表

#### 数据聚合规则
- **时间维度**: 按每分钟聚合（从每分钟的第0秒到第59秒）
- **价格聚合**: 1美元精度，使用向上取整（ceil）方式
- **数据源**: 主动买单量和主动卖单量的实时聚合

#### 可视化特性
- **X轴**: 时间轴（分钟级别）
- **Y轴**: 价格轴（1美元精度的价格层级）
- **图表类型**: 水平柱状图

#### 柱状图绘制规则
- **买单可视化**:
  - 半透明绿色柱状图向右侧水平生长
  - 柱状图长度与买单累计量成正比
  - 显示具体的成交量数值

- **卖单可视化**:
  - 半透明红色柱状图向左侧水平生长
  - 柱状图长度与卖单累计量成正比
  - 显示具体的成交量数值

#### 参考线功能
- **当前价格线**: 黄色实线，实时跟踪当前价格
- **最优买价线**: 绿色虚线，显示最优买价
- **最优卖价线**: 红色虚线，显示最优卖价

### 3. 实时更新机制
- **数据同步**: 与订单簿数据实时同步
- **滑动窗口**: 显示最近20-30分钟的数据
- **自动清理**: 自动移除过旧数据，保持性能
- **刷新频率**: 维持1ms的UI刷新频率

### 4. 交互功能
- **缩放控制**: 支持鼠标滚轮缩放
- **平移拖拽**: 支持鼠标拖拽查看历史数据
- **窗口调整**: 可调整显示的时间窗口大小（10-60分钟）
- **自动跟随**: 可选择是否自动跟随最新数据

## 技术实现

### 核心组件
1. **TimeFootprintData**: 时间维度数据管理器
2. **TimeFootprintChart**: 图表渲染组件
3. **MinuteData**: 分钟级聚合数据结构
4. **ChartDataPoint**: 图表数据点结构

### 数据流程
1. **交易数据接收** → **实时聚合** → **分钟级存储** → **图表渲染**
2. **滑动窗口管理** → **过期数据清理** → **性能优化**

### 依赖更新
- 添加了 `egui_plot = "0.27"` 依赖
- 集成到现有的egui GUI框架中

## 使用说明

### 启动程序
```bash
cargo run
```

### 界面说明
- 程序启动后会显示左右分割的界面
- 左侧显示实时订单簿数据
- 右侧显示时间维度足迹图表
- 图表会随着交易数据的接收实时更新

### 控制面板
- **显示窗口**: 调整显示的时间范围（10-60分钟）
- **自动跟随**: 开启/关闭自动跟随最新数据
- **重置缩放**: 重置图表缩放级别

## 性能优化

### 数据缓存
- 实现了智能数据缓存机制
- 只在数据变化时更新图表
- 避免不必要的重复计算

### 滑动窗口
- 自动维护固定大小的数据窗口
- 及时清理过期数据
- 保持内存使用稳定

### 渲染优化
- 使用增量更新策略
- 优化图表渲染性能
- 支持大量数据点的流畅显示

## 配置选项

### 默认设置
- 显示窗口: 25分钟
- 滑动窗口: 30分钟
- 价格精度: 1美元
- 刷新间隔: 1ms

### 可调整参数
- 时间窗口大小
- 柱状图透明度
- 颜色配置
- 缩放级别

## 未来扩展

### 计划功能
- 支持多时间框架（1分钟、5分钟、15分钟）
- 添加成交量加权平均价格（VWAP）指标
- 支持自定义价格精度
- 添加更多技术指标叠加

### 性能改进
- 进一步优化大数据量处理
- 支持数据导出功能
- 添加历史数据回放功能

## 注意事项

1. **数据精度**: 价格聚合使用向上取整，可能与原始价格略有差异
2. **内存使用**: 长时间运行会积累历史数据，程序会自动清理
3. **网络依赖**: 需要稳定的网络连接以接收实时数据
4. **系统要求**: 建议使用支持硬件加速的显卡以获得最佳性能

## 故障排除

### 常见问题
- **图表不显示数据**: 检查网络连接和WebSocket状态
- **性能问题**: 尝试减小显示窗口大小
- **界面异常**: 重启程序或调整窗口大小

### 日志信息
程序运行时会生成详细的日志信息，可用于问题诊断和性能分析。
